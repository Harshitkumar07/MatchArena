{
  "rules": {
    ".read": false,
    ".write": false,
    
    "users": {
      "$uid": {
        ".read": "$uid === auth.uid || auth.token.role === 'admin'",
        ".write": "$uid === auth.uid && !data.exists() || auth.token.role === 'admin'",
        "role": {
          ".read": "auth != null",
          ".write": "auth.token.role === 'admin'"
        },
        "displayName": {
          ".validate": "newData.isString() && newData.val().length <= 50"
        },
        "email": {
          ".validate": "newData.isString() && newData.val().matches(/^[^@]+@[^@]+$/)"
        },
        "sports": {
          ".validate": "newData.hasChildren(['cricket', 'football', 'kabaddi'])"
        }
      }
    },
    
    "matches": {
      ".indexOn": ["status", "startsAt"],
      "$sport": {
        ".read": true,
        "$matchId": {
          ".write": "auth != null && auth.token.role === 'admin'",
          "status": {
            ".validate": "newData.isString() && newData.val().matches(/^(live|upcoming|completed)$/)"
          },
          "visibility": {
            ".validate": "newData.val() === 'public'"
          }
        }
      }
    },
    
    "series": {
      "$sport": {
        ".read": true,
        "$seriesId": {
          ".write": "auth != null && auth.token.role === 'admin'"
        }
      }
    },
    
    "communities": {
      "$sport": {
        "posts": {
          ".indexOn": ["createdAt", "votes", "reports"],
          "$postId": {
            ".read": true,
            ".write": "auth != null && (newData.child('authorId').val() === auth.uid || auth.token.role === 'moderator' || auth.token.role === 'admin')",
            "authorId": {
              ".validate": "!data.exists() && newData.val() === auth.uid || data.val() === newData.val()"
            },
            "title": {
              ".validate": "newData.isString() && newData.val().length >= 3 && newData.val().length <= 200"
            },
            "content": {
              ".validate": "newData.isString() && newData.val().length >= 1 && newData.val().length <= 20000"
            },
            "votes": {
              ".validate": "newData.isNumber()"
            },
            "reports": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "deleted": {
              ".write": "auth.token.role === 'moderator' || auth.token.role === 'admin'",
              ".validate": "newData.isBoolean()"
            }
          }
        },
        "comments": {
          ".indexOn": ["postId", "createdAt"],
          "$commentId": {
            ".read": true,
            ".write": "auth != null && (newData.child('authorId').val() === auth.uid || auth.token.role === 'moderator' || auth.token.role === 'admin')",
            "authorId": {
              ".validate": "!data.exists() && newData.val() === auth.uid || data.val() === newData.val()"
            },
            "postId": {
              ".validate": "newData.isString() && root.child('communities').child($sport).child('posts').child(newData.val()).exists()"
            },
            "content": {
              ".validate": "newData.isString() && newData.val().length >= 1 && newData.val().length <= 10000"
            },
            "parentId": {
              ".validate": "newData.val() === null || (newData.isString() && root.child('communities').child($sport).child('comments').child(newData.val()).exists())"
            },
            "deleted": {
              ".write": "auth.token.role === 'moderator' || auth.token.role === 'admin'",
              ".validate": "newData.isBoolean()"
            }
          }
        },
        "votes": {
          "$postId": {
            "$userId": {
              ".read": "auth != null && $userId === auth.uid",
              ".write": "auth != null && $userId === auth.uid",
              ".validate": "newData.isNumber() && (newData.val() === 1 || newData.val() === -1 || newData.val() === 0)"
            }
          }
        }
      }
    },
    
    "notifications": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".indexOn": ["createdAt", "read"],
        "$notificationId": {
          ".write": "$uid === auth.uid || auth.token.role === 'admin'"
        }
      }
    },
    
    "reports": {
      ".indexOn": ["status", "createdAt"],
      "$reportId": {
        ".read": "auth != null && (auth.token.role === 'moderator' || auth.token.role === 'admin')",
        ".write": "auth != null",
        "reporterId": {
          ".validate": "!data.exists() && newData.val() === auth.uid"
        },
        "targetType": {
          ".validate": "newData.isString() && newData.val().matches(/^(post|comment|user)$/)"
        },
        "status": {
          ".validate": "newData.isString() && newData.val().matches(/^(open|reviewed|closed)$/)",
          ".write": "auth.token.role === 'moderator' || auth.token.role === 'admin'"
        }
      }
    },
    
    "admin": {
      "settings": {
        ".read": true,
        ".write": "auth != null && auth.token.role === 'admin'",
        "maintenance": {
          ".validate": "newData.isBoolean()"
        },
        "allowedSports": {
          ".validate": "newData.hasChildren() && newData.val().length >= 1"
        }
      },
      "apiLimits": {
        ".read": "auth != null && auth.token.role === 'admin'",
        ".write": "auth != null && auth.token.role === 'admin'"
      }
    }
  }
}
